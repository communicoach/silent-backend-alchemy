<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Conversation Pathways - CommuniCoach</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="conversation-pathways.css">
    <style>
/* Conversation Pathways CSS */
        /* ====== COLORS & THEMES ====== */
    :root {
      --primary-color: #2d4a3e;
      --secondary-color: #1b4072;
      --accent-color: #a1ce3e;
      --highlight-color: #dcefc6;
      --energy-color: #74b49b;
      --error-color: #ff6b6b;
      --shadow-color: rgba(45, 74, 62, 0.15);
      --bg-color: #ffffff;
      --bg-secondary: #f9fef3;
      --bg-card: #ffffff;
      --text-primary: #2d4a3e;
      --text-secondary: #555;
      --text-light: #ffffff;

      --user-bubble-bg: #e8f4f8;
      --partner-bubble-bg: #f0f0f0;
      --coach-bubble-bg: #dcefc6;

      --gradient-bg: linear-gradient(
        135deg,
        rgba(45, 74, 62, 0.05),
        rgba(161, 206, 62, 0.07)
      );
      --border-color: #e0e0e0;
      --input-bg: #ffffff;
      --footer-bg: url(".vscode/Images/situationfooter.png"); /* Adjusted path */
      --progress-bg: #e0e0e0;
      --progress-fill: #136f6f;
    }
    

    [data-theme="dark"] {
      --primary-color: #78a891;
      --secondary-color: #60a3d9;
      --highlight-color: #314a2e;
      --shadow-color: rgba(0, 0, 0, 0.25);

      --bg-color: #121212;
      --bg-secondary: #1e1e1e;
      --bg-card: #242424;

      --text-primary: #e0e0e0;
      --text-secondary: #aaaaaa;

      --user-bubble-bg: #2d4a3e;
      --partner-bubble-bg: #333333;
      --coach-bubble-bg: #314a2e;

      --gradient-bg: linear-gradient(
        135deg,
        rgba(45, 74, 62, 0.15),
        rgba(161, 206, 62, 0.17)
      );
      --border-color: #444444;
      --input-bg: #333333;

      --progress-bg: #444444;
      --progress-fill: #78c7ba;
    }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Poppins', sans-serif;
            background-image: url('.vscode/Images/pattern-bg5.png');
            background-size: cover;
            background-attachment: fixed;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            z-index: -1;
        }

        /* Header and Navigation */
        .header-wrapper {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: 0 2px 20px var(--shadow-color);
        }

        .top-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 15px 0;
            color: var(--primary-color);
            position: relative;
        }

        .top-nav a {
            color: var(--primary-color);
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .logo {
            position: absolute;
            left: 20px;
        }

        .logo img {
            height: 40px;
        }

        .top-nav a:hover {
            background: var(--highlight-color);
        }

        .top-nav a.current {
            background: #136f6f;
            color: white;
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            padding: 10px 0;
            background: rgba(255, 255, 255, 0.8);
        }

        .progress-bar {
            width: 80%;
            margin: 0 auto;
            height: 8px;
            background: #7cbcca;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar .progress {
            width: 60%; /* Updated for situation room page */
            height: 100%;
            background: linear-gradient(90deg, #136f6f, #136f6f);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Mobile Menu */
        .mobile-menu-button {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--primary-color);
            position: absolute;
            right: 20px;
            top: 15px;
        }
        /* Add this to your existing style section */
/* Dark Mode Toggle */
.dark-mode-toggle {
    position: absolute;
    right: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.toggle-label {
    font-size: 0.9rem;
    color: var(--text-primary);
}

.switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
}

.slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
}

input:checked + .slider {
    background-color: var(--accent-color);
}

input:checked + .slider:before {
    transform: translateX(26px);
}

.slider.round {
    border-radius: 34px;
}

.slider.round:before {
    border-radius: 50%;
}

/* Mobile Menu */
.mobile-menu-button {
    display: none;
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text-primary);
    position: absolute;
    right: 20px;
    top: 15px;
}





        /* Hero Section */
        .hero-section {
            margin-top: 100px;
            padding: 4rem 0;
            background-color: #ffffff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            position: relative;
        }

        .hero-content {
            display: flex;
            align-items: center;
            gap: 4rem;
        }

        .hero-text {
            flex: 1.2;
        }

        .hero-image {
            flex: 1;
        }

        .hero-image img {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .content-card {
            background-color: var(--highlight-color);
            background-size: cover;
            background-position: center;
            border-radius: 15px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px var(--shadow-color);
            position: relative;
            overflow: hidden;
        }

        .content-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            z-index: 0;
        }

        .content-card > * {
            position: relative;
            z-index: 1;
        }

        .section-icon {
            color: #ff221f;
            font-size: 2rem;
            margin-bottom: 1rem;
            display: block;
            text-align: center;
        
        }

        .hero-text h1 {
            font-size: 1.75em;
            margin-bottom: 20px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .hero-text p {
            font-size: 1.1em;
            line-height: 1.5;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .italic-text {
            font-style: italic;
            font-weight: 500;
        }

        /* Input Section */
        .input-section {
            max-width: 1000px;
            margin: 40px auto;
            padding: 40px;
            background-color: #ffffff;
            position: relative;
            border-radius: 15px;
            box-shadow: 0 4px 20px var(--shadow-color);
            z-index: 3;
        }

        .input-section::before {
            content: '';
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(220, 239, 198, 0.1);
            z-index: 2; /* Below textarea */
            border-radius: 15px;
            box-shadow: 0 4px 30px var(--shadow-color);
            position: absolute;
        }

        .input-section p {
            color: var(--primary-color);
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 30px;
            position: relative;
            z-index: 3;
        }

        .textarea-container {
            position: relative;
            margin-bottom: 70px; /* Space for button */
            background-color: #ffffff;
            border-radius: 15px;
            z-index: 4; /* Higher than overlay */
        }

        textarea {
            width: 100%;
            height: 200px;
            padding: 20px;
            border: 2px solid var(--secondary-color);
            border-radius: 15px;
            font-size: 1.1em;
            color: var(--primary-color);
            resize: vertical;
            transition: all 0.3s ease;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            background-color: #ffffff;
            z-index: 5; /* Higher than container */
            position: relative;
        }

        textarea:focus {
            outline-color: var(--primary-color);
            border-color: var(--accent-color);
            background-color: #ffffff;
            box-shadow: 0 0 0 4px rgba(161, 206, 62, 0.1);
            z-index: 5;
        }

        /* Microphone Icon */
        .microphone-icon {
            position: absolute;
            right: 20px;
            bottom: 20px;
            width: 50px;
            height: 50px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px var(--shadow-color);
            z-index: 6;
        }

        .microphone-icon::before {
            content: '🎤';
            font-size: 24px;
            z-index: 7;
        }

        .microphone-icon:hover {
            transform: scale(1.1);
            background: var(--energy-color);
        }

        .microphone-icon.listening {
            animation: pulse 1.5s infinite;
            background: var(--error-color);
        }

        /* Button Styles */
        .gradient-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #5885bd, #1b4072, #011f46);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            font-size: 1.1em;
            cursor: pointer;
            z-index: 6;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .gradient-btn:hover {
            transform: translateX(-50%) translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            background: linear-gradient(135deg, #1b4072, #8AB0AB, #0a0a0a);
            color: #f1f1f1;
        }

        /* Processing State */
        .gradient-btn.processing {
            position: relative;
            color: transparent;
            pointer-events: none;
        }

        /* Spinner for Processing State */
        .gradient-btn.processing::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.6);
            border-top: 3px solid white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: spin 1s linear infinite;
        }

        /* Info Cards */
        .info-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            padding: 40px;
            max-width: 1200px;
            margin: 20px auto 40px;
            position: relative;
            z-index: 2;
        }

        .info-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px var(--shadow-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }

        .info-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-color);
        }

        .info-card h3 {
            color: var(--primary-color);
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .info-card .icon {
            height: 80px;
            margin-bottom: 20px;
            background-position: center;
            background-repeat: no-repeat;
            background-size: contain;
            transition: all 0.3s ease;
        }

        .info-card-content {
            color: var(--primary-color);
            line-height: 1.6;
            font-size: 0.95em;
        }

        .info-card .card-hover-content {
            display: none;
            margin-top: 10px;
            color: var(--primary-color);
            font-size: 0.9em;
            line-height: 1.5;
        }

        .info-card:hover .card-hover-content {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        /* Footer */
        .footer-nav {
            width: 100%;
            margin-top: auto;
            color: #ffffff;
            background: url('.vscode/Images/situationfooter.png') no-repeat center center;
            background-size: cover;
            min-height: 60px;
            padding: 15px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .footer-nav p {
            margin: 0;
        }

        .footer-nav a {
            color: white;
            text-decoration: none;
            transition: opacity 0.3s ease;
        }

        .footer-nav a:hover {
            opacity: 0.8;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.8s ease forwards;
        }

        .delay-1 {
            animation-delay: 0.2s;
        }

        .delay-2 {
            animation-delay: 0.4s;
        }

        .delay-3 {
            animation-delay: 0.6s;
        }

        .delay-4 {
            animation-delay: 0.8s;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .top-nav {
                flex-direction: column;
                padding: 10px 0;
            }

            .nav-links {
                display: none;
                width: 100%;
                flex-direction: column;
                gap: 10px;
                text-align: center;
                padding-top: 10px;
            }

            .nav-links.active {
                display: flex;
            }

            .logo {
                position: static;
                margin-bottom: 10px;
            }

            .mobile-menu-button {
                display: block;
            }

            .hero-content {
                flex-direction: column-reverse;
                gap: 2rem;
                text-align: center;
            }

            .hero-text h1 {
                font-size: 1.8em;
            }

            .hero-text p {
                font-size: 1em;
            }

            .input-section {
                margin: 20px 20px 40px;
                padding: 30px 20px;
            }

            .info-cards-container {
                grid-template-columns: 1fr;
                padding: 20px;
                gap: 30px;
            }

            .info-card .icon {
                height: 120px; /* Increased size for mobile */
            }

            .container {
                padding: 0 1rem;
            }

            .footer-nav {
                flex-direction: column;
                text-align: center;
                padding: 20px 0;
                gap: 10px;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .info-cards-container {
                grid-template-columns: repeat(2, 1fr);
                padding: 30px;
            }

            .container {
                padding: 0 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header / Nav / Dark Mode -->
  <div class="header-wrapper">
    <div class="top-nav">
      <a href="#" class="logo"><img src=".vscode/Images/CClogo.png" alt="CommuniCoach"></a>
      <button class="mobile-menu-button" onclick="toggleMenu()">☰</button>
      <div class="nav-links" id="navLinks">
                <a href="welcome.html">Welcome</a>
                <a href="tone-selection.html">Tone Selection</a>
                <a href="situation-room.html" class="current">Situation Room</a>
                <a href="refined-narrative.html">Refined Narrative</a>
            </div>
        <!-- Dark Mode Toggle -->
      <div class="dark-mode-toggle">
        <span class="toggle-label">Dark Mode</span>
        <label class="switch">
          <input type="checkbox" id="darkModeToggle" />
          <span class="slider round"></span>
        </label>
      </div>
    </div>
    <div class="progress-bar-container">
      <div class="progress-bar">
        <div class="progress"></div>
      </div>
    </div>
  </div>
        
        <!-- Hero Section - Side by Side Layout -->
    <section class="hero-section">
        <div class="container">
            <div class="hero-content">
                <div class="hero-text fade-in">
                    <div class="content-card">
                        <i class="fa-solid fa-comments section-icon"></i><h1>The Situation Room</h1>
                        <p>This is your <span class="italic-text">venting space</span> - where messy, raw thoughts become clarity. Don't worry about grammar, coherence, or how you sound - just let it all out exactly as it comes to mind. Include any frustrations, confusion, and emotions without filter. Your AI coach isn't judging, and your unfiltered thoughts are the key to creating something clear and powerful.</p>
                    </div>
                </div>
                <div class="hero-image fade-in delay-1">
                    <img src=".vscode/Images/pond.png" alt="Situation Room">
                </div>
            </div>
        </div>
    </section>

    <!-- Input Section -->
    
    <div class="input-section fade-in delay-1">
        <p></p>
        
        <div class="textarea-container">
            <textarea placeholder="Vent freely here... no need for complete sentences, perfect grammar or organization - just let your thoughts flow (Click the microphone icon to speak instead)"></textarea>
            <div class="microphone-icon" id="micIcon"></div>
        </div>
        
        <button class="gradient-btn" onclick="slideToNext()">Next: Refine Your Narrative</button>
    </div>
   
        
        

    <!-- Info Cards Section -->
    <div class="info-cards-container">
        <div class="info-card fade-in delay-1">
            <div class="icon" style="background-image: url('.vscode/Images/info2.png');"></div>
            <h3>Permission to Be Messy</h3>
            <div class="info-card-content">
                <p>Your jumbled, imperfect thoughts are exactly what we need - no filter required.</p>
                <div class="card-hover-content">
                    <p>Feel free to ramble, contradict yourself, use incomplete sentences, or express strong emotions. Typos, tangents, and half-formed ideas are all welcome. The AI isn't judging - it's here to help process what you're feeling.</p>
                </div>
            </div>
        </div>

        <div class="info-card fade-in delay-2">
            <div class="icon" style="background-image: url('.vscode/Images/info4.png');"></div>
            <h3>No Solutions Needed Yet</h3>
            <div class="info-card-content">
                <p>Focus only on expressing your situation now - solutions will come later.</p>
                <div class="card-hover-content">
                    <p>Don't worry about suggesting fixes or next steps yet. This stage is purely about getting everything out. The Action Arena will help with solutions after your thoughts are clear.</p>
                </div>
            </div>
        </div>

        <div class="info-card fade-in delay-3">
            <div class="icon" style="background-image: url('.vscode/Images/info3.png');"></div>
            <h3>Your Privacy Is Protected</h3>
            <div class="info-card-content">
                <p>Your raw thoughts fade away as you refine your narrative.</p>
                <div class="card-hover-content">
                    <p>The venting process is a stepping stone. As you move through the app, those initial messy thoughts naturally transform into your refined narrative - the 'raw' version doesn't follow you around.</p>
                </div>
            </div>
        </div>

        <div class="info-card fade-in delay-4">
            <div class="icon" style="background-image: url('.vscode/Images/info1.png');"></div>
            <h3>It's Working When It Feels Easy</h3>
            <div class="info-card-content">
                <p>The less you overthink, the more effective this process becomes.</p>
                <div class="card-hover-content">
                    <p>This shouldn't feel like work. The most powerful insights come when you're just speaking naturally, as if talking to a trusted friend. Let your thoughts flow without analyzing them.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Section -->
    <footer class="footer-nav">
        <p>&copy; 2024 CommuniCoach. All rights reserved.</p>
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of Service</a>
    </footer>

    <script>
       // Shared UI
const darkModeToggle = document.getElementById('darkModeToggle');
const progressBarEl = document.querySelector('.progress-bar .progress');

    
        document.addEventListener('DOMContentLoaded', () => {
            // Standard interface - Speech recognition
            const micIcon = document.getElementById('micIcon');
            const textarea = document.querySelector('textarea');
            
            // Toggle interface elements
            const interfaceToggle = document.getElementById('interface-toggle');
            const standardInterface = document.querySelector('.input-section');
            const infoCardsContainer = document.querySelector('.info-cards-container');
         
            
           
            
            // Check if toggle elements exist
            if (interfaceToggle && standardInterface && conversationalInterface) {
                // Initialize based on stored preference (if any)
                const storedPreference = localStorage.getItem('useConversationalInterface');
                if (storedPreference === 'true') {
                    interfaceToggle.checked = true;
                    standardInterface.style.display = 'none';
                    infoCardsContainer.style.display = 'none';
                    conversationalInterface.style.display = 'block';
                }
                
                // Handle toggle changes
                interfaceToggle.addEventListener('change', () => {
                    if (interfaceToggle.checked) {
                        // Switch to conversational interface
                        standardInterface.style.display = 'none';
                        infoCardsContainer.style.display = 'none';
                        conversationalInterface.style.display = 'block';
                        localStorage.setItem('useConversationalInterface', 'true');
                    } else {
                        // Switch to standard interface
                        standardInterface.style.display = 'block';
                        infoCardsContainer.style.display = 'grid';
                        conversationalInterface.style.display = 'none';
                        localStorage.setItem('useConversationalInterface', 'false');
                    }
                });
            }
            
        // Set initial theme based on localStorage
  const savedTheme = localStorage.getItem('theme') || 'light';
  if (savedTheme === 'dark') {
    document.documentElement.setAttribute('data-theme', 'dark');
    darkModeToggle.checked = true;
  }

  darkModeToggle.addEventListener('change', () => {
    const isDark = darkModeToggle.checked;
    document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  });
            
            // Function to finalize the conversation and proceed
            function finalizeConversation() {
                // Collect all user messages to form the complete narrative
                const userMessages = [];
                document.querySelectorAll('.message.user p').forEach(p => {
                    userMessages.push(p.textContent);
                });
                
                // Combine all user messages into one narrative
                const completeNarrative = userMessages.join('\n\n');
                
                // Set the narrative to the textarea of the standard interface
                const standardTextarea = document.querySelector('.textarea-container textarea');
                if (standardTextarea) {
                    standardTextarea.value = completeNarrative;
                }
                
                // Add a processing message
                addMessage('coach', 'Processing your narrative and preparing to refine it...');
                
                // Show loading state
                const finalizeButtons = document.querySelectorAll('.finalize-btn, .continue-btn');
                finalizeButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.style.opacity = 0.5;
                });
                
                // Call the standard slideToNext function after a brief delay
                setTimeout(() => {
                    slideToNext();
                }, 1500);
            }
    
            // Initialize speech recognition for standard interface
            if (micIcon && textarea) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                
                if (!SpeechRecognition) {
                    console.warn('Speech recognition not supported');
                    micIcon.style.display = 'none';
                    return;
                }
    
                const recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';
    
                let isRecognizing = false;
                let finalTranscript = '';
    
                micIcon.addEventListener('click', () => {
                    if (isRecognizing) {
                        recognition.stop();
                    } else {
                        // Get existing text from textarea
                        finalTranscript = textarea.value;
                        recognition.start();
                    }
                });
    
                recognition.onstart = () => {
                    console.log('Speech recognition started');
                    isRecognizing = true;
                    micIcon.classList.add('listening');
                };
    
                recognition.onend = () => {
                    console.log('Speech recognition ended');
                    isRecognizing = false;
                    micIcon.classList.remove('listening');
                };
    
                recognition.onresult = (event) => {
                    let interimTranscript = '';
                    
                    // Process new results only
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            // Only add to final transcript if it's a final result
                            if (!finalTranscript.endsWith(' ')) {
                                finalTranscript += ' ';
                            }
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }
    
                    // Update textarea with combined transcripts
                    textarea.value = finalTranscript + interimTranscript;
                };
    
                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    isRecognizing = false;
                    micIcon.classList.remove('listening');
                };
            }
    
            // Add animation to elements when they come into view
            const fadeElems = document.querySelectorAll('.fade-in');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = 1;
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, {
                threshold: 0.1
            });
            
            fadeElems.forEach(elem => {
                elem.style.opacity = 0;
                elem.style.transform = 'translateY(20px)';
                elem.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
                observer.observe(elem);
            });
        });
    
        async function slideToNext() {
            try {
                const userNarrative = document.querySelector('textarea').value;
                const selectedTones = JSON.parse(localStorage.getItem('selectedTones') || '[]');
    
                if (!userNarrative.trim()) {
                    alert('Please share your situation before proceeding.');
                    return;
                }
    
                // Get the button element
                const button = document.querySelector('.gradient-btn');
    
                // Add processing state
                button.classList.add('processing');
    
                try {
                    const response = await fetch('http://localhost:5506/api/chatgpt', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            prompt: userNarrative,
                            selectedTones: selectedTones,
                        }),
                    });
    
                    const responseData = await response.json();
    
                    if (!response.ok || responseData.error) {
                        throw new Error(responseData.error || `HTTP error! status: ${response.status}`);
                    }
    
                    // Save responses and navigate
                    localStorage.setItem('refinedNarrative', responseData.response);
                    localStorage.setItem('originalNarrative', userNarrative);
                    window.location.href = 'refined-narrative.html';
                } catch (error) {
                    console.error('Processing error:', error);
                    alert('There was an error processing your narrative. Please try again.');
                } finally {
                    // Remove processing state
                    button.classList.remove('processing');
                }
            } catch (error) {
                console.error('Error in slideToNext:', error);
                alert('An unexpected error occurred. Please try again.');
            }
        }
    </script>
</body>
</html>